<!DOCTYPE html>
<html>
<head>
    <meta charset='utf-8'>
    <title>Spectre</title>
    <meta name='viewport' content='width=device-width, initial-scale=1'>
<style>
    body {
	margin: 0;
	background-color: rgb(255, 255, 255);
	color: #fff;
	font-family: Monospace;
	overscroll-behavior: none;
}
#container{
    height: 100%;
    width: 100%;
    overscroll-behavior: none;
    position: absolute;
    overflow:hidden;
}
</style>
</head>
<body>
    <div id="container"></div>
    <!-- <script type="module" src="./cube.js"></script> -->
    <script type="module">
        import * as Spectre from "../dist/js/spectre.js";
        let container;
        let renderer;
        let scene;
        let mesh;
        let camera;
        async function init() {
            container = document.getElementById("container");
            renderer = new Spectre.WebGPURenderer({
                powerPreference: "high-performance",
                antialias: true,
            });
            await renderer.init();
            container.appendChild(renderer.domElement);

            scene = new Spectre.Scene();

            camera = new Spectre.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 1, 10000);
            camera.position.z = 1600;
            camera.lookAt(new Spectre.Vector3(0, 0, 0));

            const controls = new Spectre.OrbitControls(camera, renderer.domElement);
            const material = new Spectre.Material();
            material.color = new Spectre.Color(1, 0, 0);
            material.transparent = true;
            material.opacity = 0.5;

            // setInterval(() => {
            //     material.transparent = !material.transparent;
            // }, 2000);

            let texutre = null;
            setInterval(() => {
                if(material.map){
                    material.map = null;
                }else{
                    material.map = texutre;
                }
            }, 2000);

           
            const loader = new Spectre.TextureLoader();
            loader.load(
                // resource URL
                "images/logo.png",

                // onLoad callback
                function (texture) {
                    texutre = texture;
                },

                // onProgress callback currently not supported
                undefined,

                // onError callback
                function (err) {
                    console.error("An error happened.");
                }
            );

            const geometry = new Spectre.BoxGeometry(20, 20, 20);

            for (let i = 0; i < 10000; i++) {

                const mesh = new Spectre.Mesh(geometry, material);

                mesh.position.x = Math.random() * 800 - 400;
                mesh.position.y = Math.random() * 800 - 400;
                mesh.position.z = Math.random() * 800 - 400;

                mesh.rotation.x = Math.random() * 2 * Math.PI;
                mesh.rotation.y = Math.random() * 2 * Math.PI;
                mesh.rotation.z = Math.random() * 2 * Math.PI;

                mesh.scale.x = Math.random() + 0.5;
                mesh.scale.y = Math.random() + 0.5;
                mesh.scale.z = Math.random() + 0.5;

                mesh.matrixWorldAutoUpdate = false;
                mesh.matrixAutoUpdate = false;
                mesh.updateMatrix();

                scene.add(mesh);

            }
        }

        function frame() {
            renderer.render(scene, camera);
            render();

            for (let i = 0, len = scene.children.length; i < len; i++) {

                const mesh = scene.children[i];
                mesh.rotateX(Math.random()*0.1);
                mesh.rotateY(Math.random()*0.1);
                mesh.updateMatrix();

            }    
        }

        function render() {
            requestAnimationFrame(() => {
                frame();
            });
        }

        function resize() {
            renderer.setSize(container.clientWidth, container.clientHeight);
        }

        window.addEventListener("resize", function () {
            resize();
        });

        init().then(() => {
            render();
        });

    </script>
</body>
</html>